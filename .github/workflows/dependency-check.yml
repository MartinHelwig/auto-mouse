# SPDX-FileCopyrightText: 2023 Martin Helwig
#
# SPDX-License-Identifier: MIT

# This workflow will execute a dependency-check

name: Dependency Check

on:
  workflow_dispatch:
  schedule:
    - cron: 0 6 * * SUN

# Declare default permissions as read only.
permissions: read-all

jobs:
  dependency:
    name: Dependency Check
    permissions:
      contents: write # required by: maven-dependency-submission-action
      packages: none
      checks: none
      actions: none
      deployments: none
      id-token: none
      issues: none
      discussions: none
      pages: none
      pull-requests: none
      repository-projects: none
      security-events: none
      statuses: none
  
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@3df4ab11eba7bda6032a0b82a6bb43b11571feac # v4.0.0
      
    - name: Set up JDK 11
      uses: actions/setup-java@9704b39bf258b59bc04b50fa2dd55e9ed76b47a8 # v4.1.0
      with:
        java-version: '11'
        distribution: 'temurin'
        cache: 'maven'
        check-latest: true
        cache-dependency-path: src/cache/cache.info
      
    - name: Dependency Check
      run: xvfb-run mvn -B dependency-check:check -Ddependency-check.skip=false --no-transfer-progress

    - name: Maven Dependency Tree Dependency Submission
      uses: advanced-security/maven-dependency-submission-action@bfd2106013da0957cdede0b6c39fb5ca25ae375e # v4.0.2
